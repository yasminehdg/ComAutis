{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ topic.title }} - Forum ComAutis</title>
<link rel="stylesheet" href="{% static 'forum/style.css' %}">
</head>
<body>
    <!-- Bouton retour -->
<a href="/forum/" style="position: fixed; top: 20px; left: 20px; background: white; padding: 12px 25px; border-radius: 25px; text-decoration: none; color: #2c3e50; font-weight: 600; box-shadow: 0 4px 15px rgba(0,0,0,0.1); z-index: 1000; transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.1)';">
    â† Retour au forum
</a>
<div class="container">
    <section class="topic-header">
        {% if topic.icon %}
            <img src="{% static 'forum/icons/' %}{{ topic.icon }}.png" class="icon" alt="IcÃ´ne" style="width: 80px !important; height: 80px !important; background: rgba(255,255,255,0.3); padding: 15px;">
        {% else %}
            <div style="width: 80px; height: 80px; background: rgba(255,255,255,0.3); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; flex-shrink: 0;">ğŸŒŸ</div>
        {% endif %}
        <div>
            <h2>{{ topic.title }}</h2>
            <p class="creator" style="color: rgba(255,255,255,0.9);">
                CrÃ©Ã© par {{ topic.created_by.username }} le {{ topic.created_at|date:"d M Y Ã  H:i" }}
            </p>
        </div>
    </section>

    <!-- RÃ©actions -->
<div class="reactions-container">
    <div class="reactions-buttons">
        {% if user.is_authenticated %}
            <button class="reaction-btn" data-reaction="like" onclick="react({{ topic.id }}, 'like')">
                ğŸ‘ <span id="count-like">0</span>
            </button>
            <button class="reaction-btn" data-reaction="love" onclick="react({{ topic.id }}, 'love')">
                â¤ï¸ <span id="count-love">0</span>
            </button>
            <button class="reaction-btn" data-reaction="support" onclick="react({{ topic.id }}, 'support')">
                ğŸ’ª <span id="count-support">0</span>
            </button>
            <button class="reaction-btn" data-reaction="celebrate" onclick="react({{ topic.id }}, 'celebrate')">
                ğŸ‰ <span id="count-celebrate">0</span>
            </button>
        {% else %}
            <p class="login-msg">Connectez-vous pour rÃ©agir</p>
        {% endif %}
    </div>
</div>
    {% if user.is_authenticated %}
    <section class="new-post">
        <h3>âœï¸ Ajouter un message</h3>
        <form method="POST">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Envoyer mon message</button>
        </form>
    </section>
    {% else %}
    <p class="login-msg">Vous devez Ãªtre connectÃ© pour poster un message.</p>
    {% endif %}

    <section class="posts-list">
        <h3>ğŸ’¬ Messages ({{ posts|length }})</h3>
        <div class="grid-container">
            {% for post in posts %}
            <div class="card post">
                <p>{{ post.content }}</p>
                <p class="author">
                    <span style="width: 35px; height: 35px; border-radius: 50%; background: linear-gradient(135deg, #f9b89e 0%, #f08a5d 100%); display: inline-flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 0.9rem;">
                        {{ post.created_by.username|first|upper }}
                    </span>
                    <span>
                        <strong>{{ post.created_by.username }}</strong> â€¢ 
                        {{ post.created_at|date:"d M Y Ã  H:i" }}
                    </span>
                </p>
            </div>
            {% empty %}
            <div class="empty-message">
                <p>ğŸŒ± Aucun message pour le moment.</p>
                <p style="margin-top: 0.5rem; font-size: 0.95rem;">Soyez le premier Ã  participer Ã  cette discussion !</p>
            </div>
            {% endfor %}
        </div>
    </section>
</div>

<script>
function react(topicId, reactionType) {
    fetch(`/forum/${topicId}/react/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': '{{ csrf_token }}'
        },
        body: `reaction_type=${reactionType}`
    })
    .then(response => response.json())
    .then(data => {
        // Mettre Ã  jour les compteurs
        document.getElementById('count-like').textContent = data.reaction_counts.like;
        document.getElementById('count-love').textContent = data.reaction_counts.love;
        document.getElementById('count-support').textContent = data.reaction_counts.support;
        document.getElementById('count-celebrate').textContent = data.reaction_counts.celebrate;
    });
}
</script>
</body>
</html>