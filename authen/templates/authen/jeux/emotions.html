<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üòä Les √âmotions - ComAutiste</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #74b9ff 100%);
            min-height: 100vh;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 25px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .header h1 {
            font-size: 48px;
            color: #2c3e50;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 22px;
            color: #7f8c8d;
        }

        .game-area {
            background: white;
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            margin-bottom: 25px;
            min-height: 600px;
        }

        .question-display {
            text-align: center;
            margin-bottom: 40px;
        }

        .question-text {
            font-size: 38px;
            color: #2c3e50;
            font-weight: bold;
            margin-bottom: 30px;
        }

        .face-container {
            display: flex;
            justify-content: center;
            margin: 40px 0;
        }

        .face-image {
            width: 350px;
            height: 350px;
            border-radius: 30px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            object-fit: cover;
            border: 8px solid white;
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        .emotions-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin: 40px 0;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .emotion-card {
            background: #f8f9fa;
            border-radius: 20px;
            padding: 25px 15px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
            border: 4px solid transparent;
            text-align: center;
        }

        .emotion-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 15px 40px rgba(0,0,0,0.25);
        }

        .emotion-emoji {
            font-size: 70px;
            margin-bottom: 10px;
        }

        .emotion-name {
            font-size: 22px;
            font-weight: bold;
            color: #2c3e50;
        }

        .emotion-card.correct {
            border-color: #27ae60;
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            animation: correctBounce 0.6s ease-out;
        }

        @keyframes correctBounce {
            0%, 100% { transform: scale(1); }
            25% { transform: scale(1.15) rotate(5deg); }
            50% { transform: scale(1.2); }
            75% { transform: scale(1.15) rotate(-5deg); }
        }

        .emotion-card.wrong {
            animation: wrongShake 0.6s ease-out;
            border-color: #e74c3c;
            background: #ffebee;
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            75% { transform: translateX(15px); }
        }

        .feedback {
            text-align: center;
            margin-top: 30px;
            font-size: 36px;
            font-weight: bold;
            min-height: 60px;
        }

        .feedback.correct {
            color: #27ae60;
            animation: fadeInUp 0.5s ease-out;
        }

        .feedback.wrong {
            color: #e74c3c;
            animation: shake 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-15px); }
            75% { transform: translateX(15px); }
        }

        .score-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            margin-bottom: 25px;
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .score-display h3 {
            font-size: 24px;
            margin-bottom: 10px;
        }

        .stars {
            font-size: 50px;
            margin: 10px 0;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 40px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            font-family: 'Comic Sans MS', sans-serif;
        }

        .btn-next {
            background: linear-gradient(135deg, #ff6b9d 0%, #ff8e53 100%);
            color: white;
        }

        .btn-next:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 107, 157, 0.4);
        }

        .btn-back {
            background: white;
            color: #2c3e50;
            border: 3px solid #2c3e50;
        }

        .btn-back:hover {
            background: #2c3e50;
            color: white;
            transform: translateY(-3px);
        }

        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            animation: confettiFall 3s ease-out forwards;
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .victory-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .victory-content {
            background: white;
            padding: 50px;
            border-radius: 30px;
            text-align: center;
            max-width: 500px;
            animation: bounceInModal 0.8s ease-out;
        }

        @keyframes bounceInModal {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .victory-emoji {
            font-size: 120px;
            margin-bottom: 20px;
            animation: spin 2s ease-in-out infinite;
        }

        @keyframes spin {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(360deg); }
        }

        .victory-content h2 {
            font-size: 48px;
            color: #27ae60;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 36px; }
            .question-text { font-size: 28px; }
            .face-image { width: 250px; height: 250px; }
            .emotion-emoji { font-size: 50px; }
            .emotion-name { font-size: 18px; }
            .game-area { padding: 25px 20px; }
            .emotions-container { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üòä Apprendre les √âmotions üòä</h1>
            <p>Regarde le visage et trouve l'√©motion !</p>
        </div>

        <div class="score-display">
            <h3>üåü Ton Score üåü</h3>
            <div class="stars" id="stars">‚≠ê‚≠ê‚≠ê</div>
            <p style="font-size: 22px; margin-top: 10px;">
                <span id="correct-count">0</span> bonnes r√©ponses sur <span id="total-count">0</span>
            </p>
        </div>

        <div class="game-area">
            <div class="question-display">
                <div class="question-text">Quelle √©motion vois-tu ?</div>
            </div>

            <div class="face-container">
                <img id="face-image" class="face-image" src="" alt="Visage √©motion">
            </div>

            <div class="emotions-container" id="emotions-container"></div>

            <div class="feedback" id="feedback"></div>
        </div>

        <div class="controls">
            <button class="btn btn-next" id="next-btn" onclick="nextQuestion()" style="display: none;">
                ‚û°Ô∏è Question Suivante
            </button>
            <button class="btn btn-back" onclick="window.location.href='/jeux/'">
                ‚¨ÖÔ∏è Retour aux Jeux
            </button>
        </div>
    </div>

    <div class="celebration" id="celebration"></div>

    <div class="victory-modal" id="victory-modal">
        <div class="victory-content">
            <div class="victory-emoji">üéâ</div>
            <h2>Bravo Champion !</h2>
            <p style="font-size: 24px; color: #7f8c8d; margin: 20px 0;">
                Tu reconnais toutes les √©motions !
            </p>
            <div class="stars" style="font-size: 70px; margin: 30px 0;">‚≠ê‚≠ê‚≠ê</div>
            <button class="btn btn-next" onclick="restartGame()">üîÑ Recommencer</button>
        </div>
    </div>

    <script>
        let currentEmotion = null;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let questionCount = 0;
        const maxQuestions = 12; // 2 questions par √©motion
        let answered = false;

        // Base de donn√©es des √©motions avec photos r√©elles
        const emotionsDatabase = {
            joyeux: {
                name: 'Joyeux',
                emoji: 'üòä',
                color: '#feca57',
                images: [
                    '/static/images/jeux/emotions/joyeux_1.png',
                    '/static/images/jeux/emotions/joyeux_2.png',
                    '/static/images/jeux/emotions/joyeux_3.png'
                ]
            },
            triste: {
                name: 'Triste',
                emoji: 'üò¢',
                color: '#74b9ff',
                images: [
                    '/static/images/jeux/emotions/triste_1.png',
                    '/static/images/jeux/emotions/triste_2.png',
                    '/static/images/jeux/emotions/triste_3.png'
                ]
            },
            colere: {
                name: 'En col√®re',
                emoji: 'üò†',
                color: '#ff7675',
                images: [
                    '/static/images/jeux/emotions/colere_1.png',
                    '/static/images/jeux/emotions/colere_2.png',
                    '/static/images/jeux/emotions/colere_3.png'
                ]
            },
            surpris: {
                name: 'Surpris',
                emoji: 'üòÆ',
                color: '#fdcb6e',
                images: [
                    '/static/images/jeux/emotions/surpris_1.png',
                    '/static/images/jeux/emotions/surpris_2.png',
                    '/static/images/jeux/emotions/surpris_3.png'
                ]
            },
            peur: {
                name: 'Peur',
                emoji: 'üò∞',
                color: '#a29bfe',
                images: [
                    '/static/images/jeux/emotions/peur_1.png',
                    '/static/images/jeux/emotions/peur_2.png',
                    '/static/images/jeux/emotions/peur_3.png'
                ]
            },
            calme: {
                name: 'Calme',
                emoji: 'üòê',
                color: '#dfe6e9',
                images: [
                    '/static/images/jeux/emotions/calme_1.png',
                    '/static/images/jeux/emotions/calme_2.png',
                    '/static/images/jeux/emotions/calme_3.png'
                ]
            }
        };

        const encouragements = [
            "Bravo ! C'est bien JOYEUX ! üòä",
            "Excellent ! Tu as reconnu la TRISTESSE ! üò¢",
            "Super ! C'est bien la COL√àRE ! üò†",
            "G√©nial ! C'est SURPRIS ! üòÆ",
            "Parfait ! Tu as vu la PEUR ! üò∞",
            "Magnifique ! C'est CALME ! üòê"
        ];

        function generateQuestion() {
            answered = false;
            questionCount++;
            totalQuestions++;
            
            document.getElementById('total-count').textContent = totalQuestions;
            document.getElementById('feedback').textContent = '';
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('next-btn').style.display = 'none';
            
            // Choisir une √©motion al√©atoire
            const emotionKeys = Object.keys(emotionsDatabase);
            const randomEmotionKey = emotionKeys[Math.floor(Math.random() * emotionKeys.length)];
            currentEmotion = emotionsDatabase[randomEmotionKey];
            
            // Choisir une photo al√©atoire de cette √©motion
            const randomImage = currentEmotion.images[Math.floor(Math.random() * currentEmotion.images.length)];
            
            // Afficher la photo
            document.getElementById('face-image').src = randomImage;
            document.getElementById('face-image').onerror = function() {
                this.src = 'https://via.placeholder.com/350?text=' + currentEmotion.name;
            };
            
            // Cr√©er les choix d'√©motions
            generateChoices();
        }

        function generateChoices() {
            const container = document.getElementById('emotions-container');
            container.innerHTML = '';
            
            // Prendre 3 √©motions incorrectes
            const wrongEmotions = [];
            const emotionKeys = Object.keys(emotionsDatabase);
            const otherEmotions = emotionKeys.filter(key => emotionsDatabase[key] !== currentEmotion);
            
            // M√©langer et prendre 3
            const shuffled = otherEmotions.sort(() => Math.random() - 0.5).slice(0, 3);
            shuffled.forEach(key => wrongEmotions.push(emotionsDatabase[key]));
            
            // M√©langer toutes les √©motions (bonne + mauvaises)
            const allEmotions = [currentEmotion, ...wrongEmotions].sort(() => Math.random() - 0.5);
            
            // Cr√©er les cartes
            allEmotions.forEach(emotion => {
                const card = document.createElement('div');
                card.className = 'emotion-card';
                card.innerHTML = `
                    <div class="emotion-emoji">${emotion.emoji}</div>
                    <div class="emotion-name">${emotion.name}</div>
                `;
                
                card.onclick = () => checkAnswer(emotion === currentEmotion, card);
                container.appendChild(card);
            });
        }

        function checkAnswer(isCorrect, card) {
            if (answered) return;
            answered = true;
            
            const allCards = document.querySelectorAll('.emotion-card');
            allCards.forEach(c => c.style.pointerEvents = 'none');
            
            const feedback = document.getElementById('feedback');
            
            if (isCorrect) {
                card.classList.add('correct');
                correctAnswers++;
                document.getElementById('correct-count').textContent = correctAnswers;
                
                feedback.textContent = `Bravo ! C'est bien ${currentEmotion.name.toUpperCase()} ! ${currentEmotion.emoji}`;
                feedback.className = 'feedback correct';
                
                playSound('correct');
                createConfetti();
                
                updateStars();
                
                setTimeout(() => {
                    if (questionCount >= maxQuestions) {
                        showVictory();
                    } else {
                        document.getElementById('next-btn').style.display = 'inline-block';
                    }
                }, 1500);
                
            } else {
                card.classList.add('wrong');
                feedback.textContent = "Regarde bien le visage ! Essaie encore ! üí™";
                feedback.className = 'feedback wrong';
                
                playSound('wrong');
                
                setTimeout(() => {
                    card.classList.remove('wrong');
                    allCards.forEach(c => c.style.pointerEvents = 'auto');
                    answered = false;
                    feedback.textContent = '';
                }, 1000);
            }
        }

        function nextQuestion() {
            if (questionCount >= maxQuestions) {
                showVictory();
            } else {
                generateQuestion();
            }
        }

        function updateStars() {
            const percentage = (correctAnswers / totalQuestions) * 100;
            let stars = '‚≠ê‚≠ê‚≠ê';
            if (percentage < 60) stars = '‚≠ê';
            else if (percentage < 80) stars = '‚≠ê‚≠ê';
            document.getElementById('stars').textContent = stars;
        }

        function createConfetti() {
            const celebration = document.getElementById('celebration');
            const colors = ['#feca57', '#74b9ff', '#ff7675', '#fdcb6e', '#a29bfe'];
            
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.3 + 's';
                celebration.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 3000);
            }
        }

        function playSound(type) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2);
            } else {
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(150, audioContext.currentTime + 0.1);
            }
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function showVictory() {
            document.getElementById('victory-modal').style.display = 'flex';
            createConfetti();
            setTimeout(createConfetti, 500);
            setTimeout(createConfetti, 1000);
        }

        function restartGame() {
            correctAnswers = 0;
            totalQuestions = 0;
            questionCount = 0;
            document.getElementById('correct-count').textContent = '0';
            document.getElementById('total-count').textContent = '0';
            document.getElementById('stars').textContent = '‚≠ê‚≠ê‚≠ê';
            document.getElementById('victory-modal').style.display = 'none';
            generateQuestion();
        }

        generateQuestion();
    </script>
</body>
</html>